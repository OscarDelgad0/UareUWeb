const variables={};async function consultarAPIEmpleados(){try{const a="https://funerariaslatinoamericana.com/asistencia/APIEnviarEmpleados.php",t=await fetch(a);return await t.json()}catch(a){console.log(a)}}async function consultarAPIActualizacion(){try{const a="https://funerariaslatinoamericana.com/asistencia/APISensor.php",t=await fetch(a);return await t.json()}catch(a){console.log(a)}}async function consultarAPIHuella(){try{const a="https://funerariaslatinoamericana.com/asistencia/APISensor.php",t=await fetch(a);return await t.json()}catch(a){console.log(a)}}async function consultarAPIAsistencia(){try{const a="https://funerariaslatinoamericana.com/asistencia/APIUltimaHuella.php",t=await fetch(a);return await t.json()}catch(a){console.log(a)}}async function colocarEmpleados(){await consultarAPIEmpleados()}async function mostrarEmpleados(){const a=document.querySelector(".contenedor-empleados");if(a){(await consultarAPI()).forEach(t=>{const{id:e,nombre:s}=t,n=document.createElement("div"),o=document.createElement("P"),c=document.createElement("P");o.textContent=e,c.textContent=s,n.appendChild(o),n.appendChild(c),a.appendChild(n)})}}async function sensor(){const a=await consultarAPIActualizacion();var t=parseInt(a[0].status_asistencia),e=Boolean(t),s=parseInt(a[0].status_registro),n=Boolean(s);e&&!n&&console.log("Sin cambios"),e||(actualizarMenuAsistencia(),actualizarAsistencia(a)),e&&n&&actualizarAsistencia(a)}async function actualizarAsistencia(a){const t=new FormData;for(const e in a[0])t.append(e,a[0][e]);t.append("status_asistencia",1),t.append("status_registro",0);try{const a="https://funerariaslatinoamericana.com/asistencia/POSTCambios.php",e=await fetch(a,{method:"POST",body:t});await e.json()}catch(a){}}async function actualizarMenuAsistencia(){const a=document.querySelector(".detector-hora"),t=document.querySelector(".nombre-card-asistencia"),e=document.querySelector(".hora-card-asistencia"),s=document.querySelector(".notificacion-asistencia"),n=document.querySelector(".notificacion-asistencia-contenedor"),o=(document.querySelector(".tarde"),await consultarAPIAsistencia()),{nombre:c,hora_entrada:i,apellido:r}=o;var l=new Date,u=l.getHours(),d=l.getMinutes(),m=u,p=u>=12?"PM":"AM",f=(u=(u%=12)||12)+":"+(d=d<10?"0"+d:d)+" "+p,[h,y]=i.split(":"),L=60*(h=parseInt(h))+(y=parseInt(y)),w=60*(m=parseInt(m))+d;console.log(L),console.log(w),w<=L?(s.textContent="A tiempo",(n.classList.contains("atiempo")||n.classList.contains("falta")||n.classList.contains("retardo"))&&(n.classList.remove("atiempo"),n.classList.remove("falta"),n.classList.remove("retardo")),n.classList.add("atiempo")):w>L&&w<=L+10?(s.textContent="Retardo",(n.classList.contains("atiempo")||n.classList.contains("falta")||n.classList.contains("retardo"))&&(n.classList.remove("atiempo"),n.classList.remove("falta"),n.classList.remove("retardo")),n.classList.add("retardo")):(s.textContent="Falta",(n.classList.contains("atiempo")||n.classList.contains("falta")||n.classList.contains("retardo"))&&(n.classList.remove("atiempo"),n.classList.remove("falta"),n.classList.remove("retardo")),n.classList.add("falta")),e.textContent=f,t.textContent=c,a.classList.remove("visible"),setTimeout((function(){a.classList.add("visible")}),4200)}async function actualizarEmpleados(a){const{id:t,time_actualizacion_now:e,date_actualizacion_now:s,time_actualizacion_past:n,date_actualizacion_past:o}=a[0],c=new FormData;c.append("id",t),c.append("time_actualizacion_now",e),c.append("date_actualizacion_now",s),c.append("time_actualizacion_past",n),c.append("date_actualizacion_past",o),c.append("actualizacion","last");try{const a="https://funerariaslatinoamericana.com/asistencia/POSTCambios.php",t=await fetch(a,{method:"POST",body:c});await t.json()}catch(a){}}function verificador(){setInterval(sensor,2e3)}document.addEventListener("DOMContentLoaded",(function(){mostrarEmpleados(),sensor(),colocarEmpleados()})),setTimeout(verificador,5e3);